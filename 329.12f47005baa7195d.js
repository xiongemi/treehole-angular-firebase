"use strict";(self.webpackChunktreehole_angular_firebase=self.webpackChunktreehole_angular_firebase||[]).push([[329],{329:(at,v,i)=>{i.r(v),i.d(v,{PostsModule:()=>rt});var a=i(240),c=i(3075),J=i(4466),P=i(9516),F=i(1352),b=i(2654),f=i(3313),N=i(2496),M=i(6162),m=i(7865);let Z=(()=>{class s{constructor(e,n){this.language=e,this.sortBy=n}}return s.type="[Posts] Get",s})(),T=(()=>{class s{constructor(e){this.pageIndex=e}}return s.type="[Posts] Change Page Index",s})(),L=(()=>{class s{constructor(e){this.pageSize=e}}return s.type="[Posts] Change Page Size",s})();const y=s=>s.posts,I=s=>y(s).posts,Q=(0,a.P1)([I],s=>s.length),S=s=>y(s).pageSize,O=(0,a.P1)([I,s=>y(s).pageIndex,S],(s,o,e)=>s.slice((o-1)*e,o*e)),D=(0,a.P1)([O,m.oS,m.j5],(s,o,e)=>s.map(n=>n.id?Object.assign(Object.assign({},n),{doesUserLike:o.some(r=>r.parentDocId===n.id),doesUserDislike:e.some(r=>r.parentDocId===n.id)}):n));var t=i(5e3),H=i(8728),h=i(9808),U=i(8054),u=i(728),E=i(6042),j=i(2683),G=i(3087),Y=i(1711),A=i(3478),V=i(2643),K=i(2466);function R(s,o){if(1&s&&(t.TgZ(0,"form",6)(1,"nz-select",7),t._UZ(2,"nz-option",8),t.ALo(3,"translate"),t._UZ(4,"nz-option",8),t.ALo(5,"translate"),t._UZ(6,"nz-option",8),t.ALo(7,"translate"),t._UZ(8,"nz-option",8),t.ALo(9,"translate"),t._UZ(10,"nz-option",8),t.ALo(11,"translate"),t.qZA()()),2&s){const e=t.oxw();t.Q6J("formGroup",e.searchForm),t.xp6(2),t.Q6J("nzValue",e.SortBy.NewestPosts)("nzLabel",t.lcZ(3,11,e.SortBy.NewestPosts)),t.xp6(2),t.Q6J("nzValue",e.SortBy.OldestPosts)("nzLabel",t.lcZ(5,13,e.SortBy.OldestPosts)),t.xp6(2),t.Q6J("nzValue",e.SortBy.MostLikes)("nzLabel",t.lcZ(7,15,e.SortBy.MostLikes)),t.xp6(2),t.Q6J("nzValue",e.SortBy.MostDislikes)("nzLabel",t.lcZ(9,17,e.SortBy.MostDislikes)),t.xp6(2),t.Q6J("nzValue",e.SortBy.MostComments)("nzLabel",t.lcZ(11,19,e.SortBy.MostComments))}}const C=function(s){return["/post",s]};function X(s,o){if(1&s){const e=t.EpF();t.TgZ(0,"nz-list-item",9)(1,"nz-list-item-meta")(2,"nz-list-item-meta-title")(3,"a",10),t._uU(4),t.qZA()(),t.TgZ(5,"nz-list-item-meta-description"),t._uU(6),t.ALo(7,"date"),t.qZA()(),t.TgZ(8,"a",10),t._uU(9),t.qZA(),t.TgZ(10,"ul",11)(11,"nz-list-item-action")(12,"button",12),t.NdJ("click",function(){const g=t.CHM(e).$implicit;return t.oxw().like(g)}),t._UZ(13,"i",13),t._uU(14),t.qZA()(),t.TgZ(15,"nz-list-item-action")(16,"button",12),t.NdJ("click",function(){const g=t.CHM(e).$implicit;return t.oxw().dislike(g)}),t._UZ(17,"i",14),t._uU(18),t.qZA()(),t.TgZ(19,"nz-list-item-action")(20,"a",10),t._UZ(21,"i",15),t._uU(22),t.qZA()()()()}if(2&s){const e=o.$implicit;t.Q6J("nzNoFlex",!0),t.xp6(3),t.Q6J("routerLink",t.VKq(15,C,e.id)),t.xp6(1),t.Oqu(e.title),t.xp6(2),t.hij(" ",t.xi3(7,12,e.createdAt,"medium")," "),t.xp6(2),t.Q6J("routerLink",t.VKq(17,C,e.id)),t.xp6(1),t.Oqu(e.message),t.xp6(4),t.Q6J("nzTheme",e.doesUserLike?"fill":"outline"),t.xp6(1),t.hij(" ",e.likesCount," "),t.xp6(3),t.Q6J("nzTheme",e.doesUserDislike?"fill":"outline"),t.xp6(1),t.hij(" ",e.dislikesCount," "),t.xp6(2),t.Q6J("routerLink",t.VKq(19,C,e.id)),t.xp6(2),t.hij(" ",e.commentsCount," ")}}function w(s,o){if(1&s){const e=t.EpF();t.TgZ(0,"nz-result",16),t.ALo(1,"translate"),t.TgZ(2,"div",17)(3,"button",18),t.NdJ("click",function(){return t.CHM(e),t.oxw().getPosts()}),t._uU(4),t.ALo(5,"translate"),t.qZA()()()}2&s&&(t.Q6J("nzTitle",t.lcZ(1,2,"MESSAGES.FAILED")),t.xp6(4),t.hij(" ",t.lcZ(5,4,"RETRY")," "))}const W=[{path:"",component:(()=>{class s{constructor(e,n,r){this.store=e,this.actions=n,this.likeDislikeService=r,this.posts=[],this.searchForm=new c.cw({sortBy:new c.NI(f.h.NewestPosts)}),this.SortBy=f.h,this.loading=!0,this.hasError=!1,this.subscription=new b.w}ngOnInit(){this.getPosts(),this.subscription.add(this.actions.pipe((0,a.xt)(N.o)).subscribe(()=>{this.getPosts()})),this.subscription.add(this.searchForm.get("sortBy").valueChanges.subscribe(()=>{this.getPosts()})),this.subscription.add(this.store.select(D).subscribe(e=>{this.posts=(0,F.Z)(e)})),this.totalPostNumber$=this.store.select(Q),this.pageSize$=this.store.select(S),this.pageIndex$=this.store.select(S)}ngOnDestroy(){this.subscription.unsubscribe()}getPosts(){this.store.dispatch(new Z(this.store.selectSnapshot(M.G3),this.searchForm.value.sortBy)).subscribe(()=>{this.loading=!1,this.hasError=!1},()=>{this.loading=!1,this.hasError=!0})}onPageIndexChange(e){this.store.dispatch(new T(e))}onPageSizeChange(e){this.store.dispatch(new L(e))}doesUserLikesComment$(e){return this.store.select((0,m.yO)(e))}doesUserDislikesComment$(e){return this.store.select((0,m.n8)(e))}like(e){this.likeDislikeService.like(this.doesUserLikesComment$(e.id),this.doesUserDislikesComment$(e.id),e)}dislike(e){this.likeDislikeService.dislike(this.doesUserLikesComment$(e.id),this.doesUserDislikesComment$(e.id),e)}trackById(e){return e.id}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(a.yh),t.Y36(a.eX),t.Y36(H.S))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-posts-home"]],decls:9,vars:15,consts:[["class","mb3",3,"formGroup",4,"ngIf"],["nzItemLayout","vertical",1,"bg-white",3,"nzLoading","nzBordered"],[3,"nzNoFlex",4,"ngFor","ngForOf","ngForTrackBy"],[1,"tc","mt3"],["nzShowSizeChanger","",3,"nzPageIndex","nzPageSize","nzTotal","nzPageSizeChang","nzPageIndexChange"],["nzStatus","warning",3,"nzTitle",4,"ngIf"],[1,"mb3",3,"formGroup"],["formControlName","sortBy"],[3,"nzValue","nzLabel"],[3,"nzNoFlex"],[3,"routerLink"],["nz-list-item-actions",""],["nz-button","","nzType","link",3,"click"],["nz-icon","","nzType","like",3,"nzTheme"],["nz-icon","","nzType","dislike",3,"nzTheme"],["nz-icon","","nzType","comment"],["nzStatus","warning",3,"nzTitle"],["nz-result-extra",""],["nz-button","","nzType","primary",3,"click"]],template:function(e,n){1&e&&(t.YNc(0,R,12,21,"form",0),t.TgZ(1,"nz-list",1),t.YNc(2,X,23,21,"nz-list-item",2),t.qZA(),t.TgZ(3,"div",3)(4,"nz-pagination",4),t.NdJ("nzPageSizeChang",function(g){return n.onPageSizeChange(g)})("nzPageIndexChange",function(g){return n.onPageIndexChange(g)}),t.ALo(5,"async"),t.ALo(6,"async"),t.ALo(7,"async"),t.qZA()(),t.YNc(8,w,6,6,"nz-result",5)),2&e&&(t.Q6J("ngIf",!n.loading&&!n.hasError),t.xp6(1),t.Q6J("nzLoading",n.loading)("nzBordered",!0),t.xp6(1),t.Q6J("ngForOf",n.posts)("ngForTrackBy",n.trackById),t.xp6(2),t.Q6J("nzPageIndex",t.lcZ(5,9,n.pageIndex$))("nzPageSize",t.lcZ(6,11,n.pageSize$))("nzTotal",t.lcZ(7,13,n.totalPostNumber$)),t.xp6(4),t.Q6J("ngIf",!n.loading&&n.hasError))},directives:[h.O5,c._Y,c.JL,c.sg,U.Vq,c.JJ,c.u,U.Ip,u.n_,h.sg,u.AA,u.yi,u.IO,P.yS,u.Pb,u.nk,u.KC,E.ix,j.w,G.Ls,Y.dE,A.ml,A.ey,V.dQ],pipes:[K.X$,h.uU,h.Ov],styles:[""]}),s})(),data:{reuse:!0}}];let q=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[[P.Bz.forChild(W)],P.Bz]}),s})();var _=i(4850),tt=i(9140),et=i(1995);let B=(()=>{class s{constructor(e){this.firestore=e}getPosts(e="en",n,r=null){const{orderByField:g,orderByDirection:x}=f.$[n];return this.firestore.collection("posts",z=>{let d=z.where("language","==",e).orderBy(g,x);return r&&(d=z.startAfter(r)),d}).get().pipe((0,_.U)(z=>z.docs.map(d=>{const k=(0,tt.n)(d.data());return k.id=d.id,k})))}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(et.ST))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac}),s})();var p=i(655),st=i(2994),nt=i(7221),ot=i(5294);let l=class{constructor(o){this.postsSerivce=o}getPosts(o,e){return o.patchState({posts:null}),this.postsSerivce.getPosts(e.language,e.sortBy).pipe((0,st.b)(n=>{if(!n||!n.length)throw n;o.patchState({posts:n})}),(0,nt.K)(n=>{throw o.dispatch(new ot.y),n}))}changePostsPageIndex(o,e){o.patchState({pageIndex:e.pageIndex})}changePostsPageNumber(o,e){o.patchState({pageSize:e.pageSize})}};l.\u0275fac=function(o){return new(o||l)(t.LFG(B))},l.\u0275prov=t.Yz7({token:l,factory:l.\u0275fac}),(0,p.gn)([(0,a.aU)(Z)],l.prototype,"getPosts",null),(0,p.gn)([(0,a.aU)(T)],l.prototype,"changePostsPageIndex",null),(0,p.gn)([(0,a.aU)(L)],l.prototype,"changePostsPageNumber",null),l=(0,p.gn)([(0,a.ZM)({name:"posts",defaults:Object.assign({},{posts:null,pageIndex:1,pageSize:10})})],l);let rt=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({providers:[B],imports:[[J.m,q,a.$l.forFeature([l]),c.u5,c.UX]]}),s})()}}]);